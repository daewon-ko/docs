# Chatper 5 연관관계 매핑기초

### 단방향 연관관계

객체를 테이블에 맞춰 데이터 중심으로 모델링 -> 협력관계를 만들 수 없다. 

* 테이블은 외래키로 조인을 사용해서 연관 테이블을 찾는다. 
* 객체는 참조를 사용하여 연관 객체를 찾는다. 
* 둘 간에는 이런 패러다임의 불일치가 존재한다. 




### 양방향 연관관계와 연관관계의 주인

* mappedBy
* 객체와 테이블간에 연관계를 맺는 차이
* 객체 -> 연관관계 포인트가 2개
  * 객체와 객체가 양방향이지만 , 사실 단방향 연관관계가 2개이다. 

```java
class A{
B b;
}

class B{
A a;
}

```

A -> B(a.getB());

B -> A(b.getA());

* 둘 중에 어떤 것을 기반으로 FK가 업데이트 되어야하는가? 
  * ex) Member <-> Team Entity(다대일) 관계가 있을때, 
    Member가 Team을 바꾸고 싶다면 Member에 있는 team 객체를 변경해야하는가? 아니면 Team에 있는 List<Member> 를 바꿔야하는가?
  * DB입장에서는 Member Table에 있는 Team_id(FK)값만 바꾸면 된다. 
* -> 둘 중 하나로 외래키를 관리해야한다. 

* 테이블 -> 연관관계 포인트 1개
  * FK로 PK가 되는 테이블과 JOIN하면 모두 알 수 있다. 
  * FK 하나로 연관관계가 마무리 

### 연관관계의 주인

양방향 매핑규칙

* 연관관계의 주인만이 외래키를 관리(등록, 수정과 관련하여)

* 주인이 아닌쪽은 읽기만 가능

* 주인은 mappedBy 속성을 사용하면 안된다. 

* ##### 외래키가 있는 쪽이 주인이된다.

* 순수 객체 상태를 고려해서 항상 양쪽에 값을 설정하는 것이 중요

  * -> 연관관계 편의 메서드등을 고려하는 것도 좋다!
  * 연관관계 편의메서드 생성시, 어느 Entity에 위치할 지는 상황마다 다를 수 있다. 
    중요한 것은 각 Entity 모두에 해당 기능의 메서드를 생성하면 무한루프에 걸릴 여지가 있으므로 한쪽에만 적절히 생성해주는 것이다. 

* 양방향 연관관계는 일단 단방향 연관관계로 작성하다가 추후 필요시에 작성한다고 생각하면 된다. 

  * JPQL등을 통해 역방향으로 탐색할때 사용한다든지.. 
  * Entity등에 자바 코드 몇 줄만 추가하면 되고, DB와는 사실 무관하다. 

* 가급적 단방향이 좋다!

  