# 다양한 연관관계 매핑

### 연관관계 매핑시 고려사항 3가지

1. 다중성
   * 다대일
   * 일대다
   * 일대일
   * 다대다
     * 실무에서 X
   * DB관점에서 생각해보면 된다. 
2. 단방향 OR 양방향
   * 테이블
     * 외래키 하나로 양쪽조인가능
     * 방향 개념 X
   * 객체
     * 참조용 필드가 있는 쪽으로 참조가능
     * 한쪽만 참조하면 단방향 / 양쪽 서로 참조시 양방향
3. 연관관계의 주인이 누구인가
   * 테이블은 외래키 하나로 테이블 연관관계르 맺음
   * 양방향 관계의 경우, 객체는 참조가 2군데
   * 연관관계의 주인 -> 외래키를 관리하는 객체
   * 주인의 반대편 -> 외래키에 영향을 주지 못하고 단순 조회만 가능

---



### 다대일 단방향 / 다대일 양방향

1. 다대일 단뱡향

​	가장 많이 사용한다. 

ex) Member <-> Team

Member가 '다'이므로 FK를 가지고 있다. (DB 관점에서 생각하면 자연스럽다. )

2. 다대일 양방향
   * 외래키가 있는 쪽이 연관관계의 주인
   * 양쪽을 서로 참조하도록 개발

### 일대다 단방향 /일대다 양방향

1. 일대다 단방향

   실무에서는 거의 사용하지 않는다. 

   Team <-> Member

   Team이 1이고 Member가 다이다. 그런데, Member가 team을 알고 싶지 않다고 가정하자. (조금 이상하지만, 비즈니스적으로 그러하다고 가정하자.)

   DB관점에서 생각하면, FK는 MEMBER Table이 관리한다. 

   

   * 1이 연관관계의 주인
   * 테이블 일대다 관계는 항상 다쪽에 외래키가 있음
   * 일대다 단방향의 경우 1에 해당하는 객체가 반대편 테이블의 FK를 관리한다.
   * @JoinTable을 반드시 사용해야한다 그렇지 않으면, 중간테이블이 생성된다. 

   일대다 단방향 단점

   * ##### 엔티티가 관리하는 외래키가 다른 테이블에 있음

   * 연관관계 관리를 위해 추가로 UPDATE SQL실행

   * ##### 일대다 단방향 보다는 다대일 양방향 매핑을 사용하자. 

2. 일대다 양방향

   * 공식적으로 존재 X

   * 다쪽에 @JoinColumn(updatable = false, insertable = false) 옵션을 준다. 

   * 읽기전용 필드를 사용해서 양방향처럼 사용가능

   * ##### 차라리 다대일 양방향을 사용하는 것이 권장



### 일대일

* 반대도 일대일
* 주 테이블이나 대상테이블 중에 외래키 선택 가능
* 외래키에 데이터베이스 유니크 제약조건 추가
  * 유니크 제약조건만 제외하면, 다대일 단방향 연관관계와 유사하다. 

* 주테이블에 외래키(주테이블이란 자주 Access하는 테이블 ex. Member)

  * 주 객체가 대상 객체의 참조를 가지는 것처럼 주테이블에 외래키를 둔다. 
  * JPA매핑 편리
  * 장점: 주 테이블만 조회해도 대상 테이블에 데이터가 있는지 확인 가능
  * 단점 : 값이 없으면, 외래키에 NULL허용

* 대상 테이블에 외래키

  * 대상 테이블에 외래키가 존재

  * 장점 : 주테이블과 대상 테이블을 일대일에서 일대다 관계로 변경할때, 테이블 구조 유지

  * 단점: 단방향에서 양방향으로 만들어야 함, 

    ##### 프록시 기능의 한계로, 지연로딩 불가. 

  ### 다대다

  실무에서 사용 X

  * 관계형 DB는 정규화된 테이블 2개로 다대다 관계를 표현불가
  * 연결 테이블을 추가해서 일대다, 다대일 관계로 풀어낸다. 
  * JPA가 지원하는 @ManyToMany사용시 , 많은 문제 야기
    * 중간테이블이 자동으로 생기게되고, 기타 비즈니스요구사항에 의해 수정시간, 등록시간과 같은 여러 필드를 등록 및 관리하기 힘든 문제 발생한다. 
    *  따라서 연결테이블을 하나의 Entity로 관리하는게 좋다.

  

 