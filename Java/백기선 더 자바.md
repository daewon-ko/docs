# 백기선 더 자바(코드를 조작하는 다양한 방법) 





**JVM**

- 자바 가상머신으로 자바 바이트 코드를 OS에 특화된 코드로 변환하여 실행
  - 인터프리터와 JIT 컴파일러가 OS에 특화된 코드로 변환한다.
  - OS에 특화된 코드란 ‘네이티브 코드’를 의미
  - 이런 부분은 OS에 의존적
- 스펙은 정해져있지만 오라클, 아마존 등 구현방식은 다르다.



**JRE**

- JVM은 홀로 적용되지 않고, 최소의 배포 단위가 ‘JRE’
- 자바 애플리케이션을 실행할 수 있도록 구성된 배포판
  - JVM + Library
  - 자바 런타임 환경에서 사용되는 프로퍼티 세팅 및 리소스 파일을 갖고 있음
- 개발관련 도구는 미포함



**JDK**

- JRE + 개발에 필요한 툴
  - JRE로는 단독으로 자바를 실행할 수는 있지만, Java 컴파일러 자체는 JRE 내에 내장되어 있지 않으므로 컴파일 불가능
- JAVA 11부터는 JDK만 적용



**자바**

- 프로그래밍 언어
- JDK에 들어있는 javac(자바 컴파일러)를 통해 바이트 코드(.class파일)로 컴파일 가능
  - cf) javap를 통해서 .class파일을 디컴파일하여 바이트 보드를 육안으로 확인 가능



**타 언어 지원**

- 최초의 JVM은 ‘자바’언어만을 지원하기 위해 만들어졌으나, 자바 언어와 직접적 연관이 있는 것이 아닌, 중간에 .class파일만 있으면 실행해주는 메커니즘
- 다른 언어로 프로그래밍하더라도, 해당 언어를 컴파일 했을때 .class파일이 만들어지기만 한다면, JVM을 활용가능하다.
  - JVM 성능최적화, JIT 컴파일러 등 JVM내의 무수한 기능을 안정적이고 빠르게 활용가능



**JVM 구조**

- 클래스 로더 시스템
  - 로딩
    - 클래스를 읽어오는 과정
  - 링킹
    - 레퍼런스를 연결하는 과정
  - 초기화
    - static 값들 초기화 및 변수 할당
- 메모리
  - 메서드
    - 클래스 수준의 정보(클래스 이름, 패키지 경로, 부모 클래스 이름, 메서드, 변수들) 저장
    - 다른 영역에서도 참조 가능한 ‘공유자원’이다.
  - 힙
    - 실제 인스턴스(객체) 저장

하단 3가지 분류는 ‘스레드’ 내에서만 공유되는 자원이다.

- 스택
  - 스레드마다 Runtime Stack을 만들고 그 내에 스택 프레임을 쌓는다.
  - 스택 프레임은 곧 ‘메서드 콜’이다.
- PC(Program Counter)
  - 스레드마다 스레드 내 현재 실행할 스택 프레임을 가리키는 포인터가 생성되는데 이것이 PC
- 네이티브 메서드 스택
  - Native Method를 생성할때마다 생성되는 스택

![image.png](blob:file:///5e00f66c-4995-4196-a6f8-c085d3a323c6)



- 실행 엔진
  - 인터프리터 : 바이트 코드를 한 줄씩 실행
    - 한줄마다 컴파일하는셈(바이트 코드 → 네이티브 코드로)
  - JIT 컴파일러
    - 인터프리터의 컴파일 효율을 높이기 위해, 인터프리터가 반복되는 코드를 발견하면, JIT 컴파일러로 반복되는 코드를 모두 네이티브 코드로 변경해둠.
    - 그 다음부터 인터프리터는 네이티브 코드로 컴파일된 코드를 바로 사용
  - GC
    - 참조되지 않는 객체를 모아서 저장



**클래스 로더의 내부 이해**

- 클래스 로더는 로딩, 링킹, 초기화 순으로 진행
- 로딩
  - 클래스 로더가 .class파일을 읽고 그 내용을 바탕으로 바이너리 데이터를 만든 후 JVM 내 ‘메서드’ 영역에 저장
  - 메서드 영역 내에 저장되는 데이터
    - FQCN(Full Qualified Class Name) : 패키지 경로를 포함한 클래스 이름
    - 클래스, 인터페이스, Enum 등 클래스 정보
    - 메서드와 변수
    - 로딩이 끝나면 ‘Class’ Type의 객체를 생성하여 ‘힙’에 저장
  - 클래스 로더 종류
    - 부트 스트랩 클래스 로	더
    - 플랫폼 클래스 로더
    - 애플리케이션 클래스 로더
- 링크
  - Veryfiy, Prepare, Resolve(Optional)의 3단계
  - Verify : .class 파일 형식의 유효성체크
  - Preparation
    - static 변수와 기본값에 필요한 메모리를 준비하는 과정
  - Resolve
    - 심볼릭 메모리 레퍼런스를 메서드 영역에 있는 실제 레퍼런스로 교체(Optional)
      - 심볼릭 메모리 레퍼런스란 클래스 파일에서 다른 클래스 타입을 참조하는 것 따위를 말한다.
- 초기화
  - static변수에 값을 할당한다.

