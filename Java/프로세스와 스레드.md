# 프로세스와 스레드



### 멀티 프로세싱과 멀티 태스킹

- 멀티 프로세싱은 하드웨어 장비의 관점, 멀티 태스킹은 OS의 관점
- 멀티 프로세싱
  - 여러 CPU 코어를 사용하여 동시에 여러 작업을 수행(병렬성의 관점)
  - 하드웨어 기반으로 성능 향상
- 멀티 태스킹
  - 단일 CPU(CPU 코어)가 여러 작업을 동시에 수행하는 것처럼 보이게 하는 것

### 프로세스와 스레드

- 프로그램을 실행하면 프로세스가 만들어지고, 프로그램이 실행됨.
- **OS 안에서 실행중인 프로그램을 프로세스**라고 함.
- **프로세스는 실행중인 프로그램의 인스턴스**
- 각 프로세스는 독립적 메모리 공간을 갖고있으며 OS에서 별도의 작업 단위로 분리해서 관리됨.
- 즉 프로세스는 OS에 의해 서로 격리되어 관리되며 다른 프로세스에 영향을 주지 않는다.

### 프로세스의 메모리 구성

- 코드
  - 프로그램의 코드가 저장되는 영역
- 데이터
  - 전역변수 및 정적변수가 저장
- 힙
  - 동적으로 할당되는 메모리 영역
- 스택
  - 메서드호출 시 생성되는 지역 변수 및 반환 주소가 저장되는 영역

### 스레드

- 하나의 프로세스는 한 개 이상의 스레드를 반드시 포함한다.
  - 각 스레드는 프로세스 내 메모리를 공유한다.
- 스레드는 프로세스 내 실행되는 작업의 단위이기도 하다.
  - 스레드를 경량 프로세스라고 하기도 함.
- 메모리 구성
  - 공유 메모리
    - 코드, 힙, 데이터
  - 스택
    - 각 스레드는 개별 스택 영역을 갖고 있음
- 프로세스는 **실행환경과 자원을 제공하는 컨테이너 역할**을 한다.
  - 메모리공간, 파일 핸들, 시스템 자원(네트워크 연결)등이 포함된다.
- 스레드는 **CPU를 사용하여 코드를 하나하나 실행**하는 주체라고 할 수 있다.

### 스레드와 스케줄링

- OS가 CPU에 어떤 프로그램이 얼만큼 실행할지를 결정하는데 이를 ‘스케줄링’이라고 함.
  - CPU를 최대한 활용할 수 있는 우선순위와 최적화 기법을 고려함.

### 컨텍스트 스위칭

- CPU가 특정 스레드를 실행하다가 멀티 태스킹 과정에서 다른 스레드 실행을 위해 문맥이 전환되는데 이를 ‘컨텍스트 스위칭’이라고 한다.
  - 가령 Thread A 실행을 하다가 Thread B 실행을 위해서는 Thread A를 잠시 멈춰야하는데 CPU는 ThreadA의 코드를 어디까지 수행하였는지 또 변수들의 값은 어떻게 되는 지 등을 저장해야하고 계산된 변수들의 값도 추후에 다시 불러와야한다. 이 모든 것을 컨텍스트 스위칭이라고 한다.
  - 이 컨텍스트 스위칭 역시 ‘비용’이다.
- **멀티 스레드는 대부분 효율적이지만, 컨텍스트 스위칭 과정으로 인해 항상 효율적인 것만은 아니다.**

### Cpu Bound / IO Bound

스레드가 하는 작업은 크게 2가지로 분류 가능하다.

- CPu Bound 작업
  - CPU의 연산 능력을 요구하는 작업
  - 계산, 데이터 처리, 알고리즘 실행 등 CPU의 처리 속도가 작업 완료 시간을 결정
- I/O Bound 작업
  - 디스크 , 네트워크, 파일 시스템과 같이 입출력 작업을 요구
  - I/O 작업이 완료될때까지 대기시간 요구

통상의 WAS는 CPU Bound 작업보다는 I/O Bound 작업이 더 많지만, 반드시 그러한 것은 아니므로 아래와 같이 설정하는 것이 권고된다.

- CPU Bound 작업의 비율이 높다면
  - CPU 코어수 + 1개 만큼 스레드 숫자를 조정한다.
  - CPU를 거의 100% 사용하는 작업이므로 스레드를 CPU 숫자에 맞춰서 최적화한다.
- I/O Bound 작업이 많다면
  - CPU 코어 수보다 많은 스레드를 생성, 성능 테스트를 통해 CPU를 최대한 활용할 수 있는 숫자까지 스레드 생성
  - 그러나, 너무 많은 스레드 생성 시 ‘컨텍스트 스위칭’으로 인한 비용 발생 가능성 감안해야한다.

참고 : 김영한 자바 고급1편